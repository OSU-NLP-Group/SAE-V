<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>saev.config API documentation</title>
<meta name="description" content="Configs for saev experiments …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>saev.config</code></h1>
</header>
<section id="section-intro">
<p>Configs for saev experiments.</p>
<p>This module should be very fast to import so that <code>python main.py --help</code> is fast.
This means that the top-level imports should not include big packages like numpy, torch, etc.
<code><a title="saev.config.TreeOfLife.n_imgs" href="#saev.config.TreeOfLife.n_imgs">TreeOfLife.n_imgs</a></code> imports numpy when it's needed, rather than importing it at the top level.</p>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="saev.config.Config"><code class="flex name class">
<span>class <span class="ident">Config</span></span>
<span>(</span><span>image_width: int = 224, image_height: int = 224, model: str = 'ViT-L-14/openai', module_name: str = 'resid', block_layer: int = -2, data: <a title="saev.config.Imagenet" href="#saev.config.Imagenet">Imagenet</a> | <a title="saev.config.TreeOfLife" href="#saev.config.TreeOfLife">TreeOfLife</a> = &lt;factory&gt;, n_workers: int = 8, d_vit: int = 1024, n_epochs: int = 3, n_reinit_batches: int = 15, vit_batch_size: int = 1024, exp_factor: int = 64, l1_coeff: float = 8e-05, lr: float = 0.0004, n_lr_warmup: int = 500, sae_batch_size: int = 1024, use_ghost_grads: bool = True, feature_sampling_window: int = 64, resample_batches: int = 32, dead_feature_window: int = 64, dead_feature_threshold: float = 1e-06, log_to_wandb: bool = True, wandb_project: str = 'saev', wandb_log_freq: int = 10, device: str = 'cuda', seed: int = 42, dtype: str = 'float32', checkpoint_path: str = 'checkpoints', slurm: bool = False, slurm_acct: str = 'PAS2136', log_to: str = './logs')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for training a sparse autoencoder on a vision transformer.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Config:
    &#34;&#34;&#34;
    Configuration for training a sparse autoencoder on a vision transformer.
    &#34;&#34;&#34;

    # Data Generating Function (Model + Training Distibuion)
    image_width: int = 224

    image_height: int = 224

    model: str = &#34;ViT-L-14/openai&#34;
    &#34;&#34;&#34;Model string, for use with open_clip.&#34;&#34;&#34;
    module_name: str = &#34;resid&#34;

    block_layer: int = -2

    data: Imagenet | TreeOfLife = dataclasses.field(default_factory=Imagenet)
    &#34;&#34;&#34;Which dataset to use.&#34;&#34;&#34;
    n_workers: int = 8
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    d_vit: int = 1024
    &#34;&#34;&#34;Dimension of the ViT activations (depends on model, module_name, and block_layer).&#34;&#34;&#34;
    n_epochs: int = 3
    &#34;&#34;&#34;Number of SAE training epochs.&#34;&#34;&#34;
    n_reinit_batches: int = 15
    &#34;&#34;&#34;Number of batches to use for SAE re-init.&#34;&#34;&#34;
    vit_batch_size: int = 1024
    &#34;&#34;&#34;Batch size for ViT inference.&#34;&#34;&#34;
    exp_factor: int = 64

    l1_coeff: float = 0.00008

    lr: float = 0.0004
    &#34;&#34;&#34;Learning rate.&#34;&#34;&#34;
    n_lr_warmup: int = 500
    &#34;&#34;&#34;Number of learning rate warmup steps.&#34;&#34;&#34;
    sae_batch_size: int = 1024
    &#34;&#34;&#34;Batch size for SAE training.&#34;&#34;&#34;

    use_ghost_grads: bool = True

    feature_sampling_window: int = 64

    resample_batches: int = 32

    dead_feature_window: int = 64

    dead_feature_threshold: float = 1e-6

    log_to_wandb: bool = True

    wandb_project: str = &#34;saev&#34;

    wandb_log_freq: int = 10

    device: str = &#34;cuda&#34;

    seed: int = 42

    dtype: str = &#34;float32&#34;

    checkpoint_path: str = &#34;checkpoints&#34;

    slurm: bool = False
    &#34;&#34;&#34;Whether to use `submitit` to run jobs on a Slurm cluster.&#34;&#34;&#34;
    slurm_acct: str = &#34;PAS2136&#34;
    &#34;&#34;&#34;Slurm account string.&#34;&#34;&#34;
    log_to: str = &#34;./logs&#34;
    &#34;&#34;&#34;Where to log Slurm job stdout/stderr.&#34;&#34;&#34;

    @property
    def reinit_size(self) -&gt; int:
        return self.n_reinit_batches * self.sae_batch_size

    @property
    def d_sae(self) -&gt; int:
        return self.d_vit * self.exp_factor

    @property
    def run_name(self) -&gt; str:
        return (
            f&#34;{self.d_sae}-L1-{self.l1_coefficient}-LR-{self.lr}-epochs-{self.n_epochs}&#34;
        )</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Config.block_layer"><code class="name">var <span class="ident">block_layer</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.checkpoint_path"><code class="name">var <span class="ident">checkpoint_path</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.d_vit"><code class="name">var <span class="ident">d_vit</span> : int</code></dt>
<dd>
<div class="desc"><p>Dimension of the ViT activations (depends on model, module_name, and block_layer).</p></div>
</dd>
<dt id="saev.config.Config.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.Imagenet" href="#saev.config.Imagenet">Imagenet</a> | <a title="saev.config.TreeOfLife" href="#saev.config.TreeOfLife">TreeOfLife</a></code></dt>
<dd>
<div class="desc"><p>Which dataset to use.</p></div>
</dd>
<dt id="saev.config.Config.dead_feature_threshold"><code class="name">var <span class="ident">dead_feature_threshold</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.dead_feature_window"><code class="name">var <span class="ident">dead_feature_window</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.dtype"><code class="name">var <span class="ident">dtype</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.exp_factor"><code class="name">var <span class="ident">exp_factor</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.feature_sampling_window"><code class="name">var <span class="ident">feature_sampling_window</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.image_height"><code class="name">var <span class="ident">image_height</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.image_width"><code class="name">var <span class="ident">image_width</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.l1_coeff"><code class="name">var <span class="ident">l1_coeff</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.log_to"><code class="name">var <span class="ident">log_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to log Slurm job stdout/stderr.</p></div>
</dd>
<dt id="saev.config.Config.log_to_wandb"><code class="name">var <span class="ident">log_to_wandb</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.lr"><code class="name">var <span class="ident">lr</span> : float</code></dt>
<dd>
<div class="desc"><p>Learning rate.</p></div>
</dd>
<dt id="saev.config.Config.model"><code class="name">var <span class="ident">model</span> : str</code></dt>
<dd>
<div class="desc"><p>Model string, for use with open_clip.</p></div>
</dd>
<dt id="saev.config.Config.module_name"><code class="name">var <span class="ident">module_name</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.n_epochs"><code class="name">var <span class="ident">n_epochs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of SAE training epochs.</p></div>
</dd>
<dt id="saev.config.Config.n_lr_warmup"><code class="name">var <span class="ident">n_lr_warmup</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of learning rate warmup steps.</p></div>
</dd>
<dt id="saev.config.Config.n_reinit_batches"><code class="name">var <span class="ident">n_reinit_batches</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of batches to use for SAE re-init.</p></div>
</dd>
<dt id="saev.config.Config.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.Config.resample_batches"><code class="name">var <span class="ident">resample_batches</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.sae_batch_size"><code class="name">var <span class="ident">sae_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for SAE training.</p></div>
</dd>
<dt id="saev.config.Config.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.slurm"><code class="name">var <span class="ident">slurm</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use <code>submitit</code> to run jobs on a Slurm cluster.</p></div>
</dd>
<dt id="saev.config.Config.slurm_acct"><code class="name">var <span class="ident">slurm_acct</span> : str</code></dt>
<dd>
<div class="desc"><p>Slurm account string.</p></div>
</dd>
<dt id="saev.config.Config.use_ghost_grads"><code class="name">var <span class="ident">use_ghost_grads</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.vit_batch_size"><code class="name">var <span class="ident">vit_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for ViT inference.</p></div>
</dd>
<dt id="saev.config.Config.wandb_log_freq"><code class="name">var <span class="ident">wandb_log_freq</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Config.wandb_project"><code class="name">var <span class="ident">wandb_project</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.Config.d_sae"><code class="name">prop <span class="ident">d_sae</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def d_sae(self) -&gt; int:
    return self.d_vit * self.exp_factor</code></pre>
</details>
</dd>
<dt id="saev.config.Config.reinit_size"><code class="name">prop <span class="ident">reinit_size</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def reinit_size(self) -&gt; int:
    return self.n_reinit_batches * self.sae_batch_size</code></pre>
</details>
</dd>
<dt id="saev.config.Config.run_name"><code class="name">prop <span class="ident">run_name</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def run_name(self) -&gt; str:
    return (
        f&#34;{self.d_sae}-L1-{self.l1_coefficient}-LR-{self.lr}-epochs-{self.n_epochs}&#34;
    )</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.Imagenet"><code class="flex name class">
<span>class <span class="ident">Imagenet</span></span>
<span>(</span><span>name: str = 'ILSVRC/imagenet-1k')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for HuggingFace Imagenet.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Imagenet:
    &#34;&#34;&#34;Configuration for HuggingFace Imagenet.&#34;&#34;&#34;

    name: str = &#34;ILSVRC/imagenet-1k&#34;
    &#34;&#34;&#34;Dataset name. Probably don&#39;t want to change this.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
        import datasets

        dataset = datasets.load_dataset(
            self.name, split=&#34;train&#34;, trust_remote_code=True
        )
        return len(dataset)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Imagenet.name"><code class="name">var <span class="ident">name</span> : str</code></dt>
<dd>
<div class="desc"><p>Dataset name. Probably don't want to change this.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.Imagenet.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
    import datasets

    dataset = datasets.load_dataset(
        self.name, split=&#34;train&#34;, trust_remote_code=True
    )
    return len(dataset)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.TreeOfLife"><code class="flex name class">
<span>class <span class="ident">TreeOfLife</span></span>
<span>(</span><span>metadata: str = 'treeoflife-10m.json', label_key: str = '.taxonomic_name.txt')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for the TreeOfLife-10M webdataset.</p>
<p>Webdatasets are designed for random sampling of the entire dataset so that over multiple epochs, every sample is seen, on average, the same number of times. However, for training sparse autoencoders, we need to calculate ViT activations exactly once for each example in the dataset. Webdatasets support this through the <a href="https://github.com/webdataset/webdataset?tab=readme-ov-file#the-wids-library-for-indexed-webdatasets"><code>wids</code></a> library.</p>
<p>Here is a short discussion of the steps required to use saev with webdatasets.</p>
<p>First, you will need to use <code>widsindex</code> (installed with the webdataset library) to create an metadata file used by wids. You can see an example file <a href="https://storage.googleapis.com/webdataset/fake-imagenet/imagenet-train.json">here</a>. To generate my own metadata file, I ran this command:</p>
<pre><code class="language-sh">uv run widsindex create         --name treeoflife-10m         --output treeoflife-10m.json         '/fs/ess/PAS2136/open_clip/data/evobio10m-v3.3/224x224/train/shard-{000000..000159}.tar'
</code></pre>
<p>It took a long time (more than an hour, less than 3 hours) and generated a <code>treeoflife-10m.json</code> file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class TreeOfLife:
    &#34;&#34;&#34;
    Configuration for the TreeOfLife-10M webdataset.

    Webdatasets are designed for random sampling of the entire dataset so that over multiple epochs, every sample is seen, on average, the same number of times. However, for training sparse autoencoders, we need to calculate ViT activations exactly once for each example in the dataset. Webdatasets support this through the [`wids`](https://github.com/webdataset/webdataset?tab=readme-ov-file#the-wids-library-for-indexed-webdatasets) library.

    Here is a short discussion of the steps required to use saev with webdatasets.

    First, you will need to use `widsindex` (installed with the webdataset library) to create an metadata file used by wids. You can see an example file [here](https://storage.googleapis.com/webdataset/fake-imagenet/imagenet-train.json). To generate my own metadata file, I ran this command:

    ```sh
    uv run widsindex create \
        --name treeoflife-10m \
        --output treeoflife-10m.json \
        &#39;/fs/ess/PAS2136/open_clip/data/evobio10m-v3.3/224x224/train/shard-{000000..000159}.tar&#39;
    ```

    It took a long time (more than an hour, less than 3 hours) and generated a `treeoflife-10m.json` file.
    &#34;&#34;&#34;

    metadata: str = &#34;treeoflife-10m.json&#34;
    &#34;&#34;&#34;Path to dataset shards.&#34;&#34;&#34;
    label_key: str = &#34;.taxonomic_name.txt&#34;
    &#34;&#34;&#34;Which key to use as the label.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Return number of images in the dataset by reading the metadata file and summing the `nsamples` fields.&#34;&#34;&#34;
        import json

        import numpy as np

        with open(self.metadata) as fd:
            metadata = json.load(fd)

        return (
            np.array([shard[&#34;nsamples&#34;] for shard in metadata[&#34;shardlist&#34;]])
            .sum()
            .item()
        )</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.TreeOfLife.label_key"><code class="name">var <span class="ident">label_key</span> : str</code></dt>
<dd>
<div class="desc"><p>Which key to use as the label.</p></div>
</dd>
<dt id="saev.config.TreeOfLife.metadata"><code class="name">var <span class="ident">metadata</span> : str</code></dt>
<dd>
<div class="desc"><p>Path to dataset shards.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.TreeOfLife.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Return number of images in the dataset by reading the metadata file and summing the <code>nsamples</code> fields.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Return number of images in the dataset by reading the metadata file and summing the `nsamples` fields.&#34;&#34;&#34;
    import json

    import numpy as np

    with open(self.metadata) as fd:
        metadata = json.load(fd)

    return (
        np.array([shard[&#34;nsamples&#34;] for shard in metadata[&#34;shardlist&#34;]])
        .sum()
        .item()
    )</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="saev" href="index.html">saev</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="saev.config.Config" href="#saev.config.Config">Config</a></code></h4>
<ul class="">
<li><code><a title="saev.config.Config.block_layer" href="#saev.config.Config.block_layer">block_layer</a></code></li>
<li><code><a title="saev.config.Config.checkpoint_path" href="#saev.config.Config.checkpoint_path">checkpoint_path</a></code></li>
<li><code><a title="saev.config.Config.d_sae" href="#saev.config.Config.d_sae">d_sae</a></code></li>
<li><code><a title="saev.config.Config.d_vit" href="#saev.config.Config.d_vit">d_vit</a></code></li>
<li><code><a title="saev.config.Config.data" href="#saev.config.Config.data">data</a></code></li>
<li><code><a title="saev.config.Config.dead_feature_threshold" href="#saev.config.Config.dead_feature_threshold">dead_feature_threshold</a></code></li>
<li><code><a title="saev.config.Config.dead_feature_window" href="#saev.config.Config.dead_feature_window">dead_feature_window</a></code></li>
<li><code><a title="saev.config.Config.device" href="#saev.config.Config.device">device</a></code></li>
<li><code><a title="saev.config.Config.dtype" href="#saev.config.Config.dtype">dtype</a></code></li>
<li><code><a title="saev.config.Config.exp_factor" href="#saev.config.Config.exp_factor">exp_factor</a></code></li>
<li><code><a title="saev.config.Config.feature_sampling_window" href="#saev.config.Config.feature_sampling_window">feature_sampling_window</a></code></li>
<li><code><a title="saev.config.Config.image_height" href="#saev.config.Config.image_height">image_height</a></code></li>
<li><code><a title="saev.config.Config.image_width" href="#saev.config.Config.image_width">image_width</a></code></li>
<li><code><a title="saev.config.Config.l1_coeff" href="#saev.config.Config.l1_coeff">l1_coeff</a></code></li>
<li><code><a title="saev.config.Config.log_to" href="#saev.config.Config.log_to">log_to</a></code></li>
<li><code><a title="saev.config.Config.log_to_wandb" href="#saev.config.Config.log_to_wandb">log_to_wandb</a></code></li>
<li><code><a title="saev.config.Config.lr" href="#saev.config.Config.lr">lr</a></code></li>
<li><code><a title="saev.config.Config.model" href="#saev.config.Config.model">model</a></code></li>
<li><code><a title="saev.config.Config.module_name" href="#saev.config.Config.module_name">module_name</a></code></li>
<li><code><a title="saev.config.Config.n_epochs" href="#saev.config.Config.n_epochs">n_epochs</a></code></li>
<li><code><a title="saev.config.Config.n_lr_warmup" href="#saev.config.Config.n_lr_warmup">n_lr_warmup</a></code></li>
<li><code><a title="saev.config.Config.n_reinit_batches" href="#saev.config.Config.n_reinit_batches">n_reinit_batches</a></code></li>
<li><code><a title="saev.config.Config.n_workers" href="#saev.config.Config.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.Config.reinit_size" href="#saev.config.Config.reinit_size">reinit_size</a></code></li>
<li><code><a title="saev.config.Config.resample_batches" href="#saev.config.Config.resample_batches">resample_batches</a></code></li>
<li><code><a title="saev.config.Config.run_name" href="#saev.config.Config.run_name">run_name</a></code></li>
<li><code><a title="saev.config.Config.sae_batch_size" href="#saev.config.Config.sae_batch_size">sae_batch_size</a></code></li>
<li><code><a title="saev.config.Config.seed" href="#saev.config.Config.seed">seed</a></code></li>
<li><code><a title="saev.config.Config.slurm" href="#saev.config.Config.slurm">slurm</a></code></li>
<li><code><a title="saev.config.Config.slurm_acct" href="#saev.config.Config.slurm_acct">slurm_acct</a></code></li>
<li><code><a title="saev.config.Config.use_ghost_grads" href="#saev.config.Config.use_ghost_grads">use_ghost_grads</a></code></li>
<li><code><a title="saev.config.Config.vit_batch_size" href="#saev.config.Config.vit_batch_size">vit_batch_size</a></code></li>
<li><code><a title="saev.config.Config.wandb_log_freq" href="#saev.config.Config.wandb_log_freq">wandb_log_freq</a></code></li>
<li><code><a title="saev.config.Config.wandb_project" href="#saev.config.Config.wandb_project">wandb_project</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Imagenet" href="#saev.config.Imagenet">Imagenet</a></code></h4>
<ul class="">
<li><code><a title="saev.config.Imagenet.n_imgs" href="#saev.config.Imagenet.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.Imagenet.name" href="#saev.config.Imagenet.name">name</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.TreeOfLife" href="#saev.config.TreeOfLife">TreeOfLife</a></code></h4>
<ul class="">
<li><code><a title="saev.config.TreeOfLife.label_key" href="#saev.config.TreeOfLife.label_key">label_key</a></code></li>
<li><code><a title="saev.config.TreeOfLife.metadata" href="#saev.config.TreeOfLife.metadata">metadata</a></code></li>
<li><code><a title="saev.config.TreeOfLife.n_imgs" href="#saev.config.TreeOfLife.n_imgs">n_imgs</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
