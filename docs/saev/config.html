<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>saev.config API documentation</title>
<meta name="description" content="All configs for all saev jobs …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>saev.config</code></h1>
</header>
<section id="section-intro">
<p>All configs for all saev jobs.</p>
<h2 id="import-times">Import Times</h2>
<p>This module should be very fast to import so that <code>python main.py --help</code> is fast.
This means that the top-level imports should not include big packages like numpy, torch, etc.
For example, <code>TreeOfLife.n_imgs</code> imports numpy when it's needed, rather than importing it at the top level.</p>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="saev.config.Activations"><code class="flex name class">
<span>class <span class="ident">Activations</span></span>
<span>(</span><span>data: <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.TreeOfLifeDataset" href="#saev.config.TreeOfLifeDataset">TreeOfLifeDataset</a> | <a title="saev.config.LaionDataset" href="#saev.config.LaionDataset">LaionDataset</a> | <a title="saev.config.Inat21Dataset" href="#saev.config.Inat21Dataset">Inat21Dataset</a> | <a title="saev.config.BrodenDataset" href="#saev.config.BrodenDataset">BrodenDataset</a> = &lt;factory&gt;, dump_to: str = './shards', model_org: Literal['open-clip', 'timm', 'dinov2'] = 'open-clip', model_ckpt: str = 'ViT-L-14/openai', vit_batch_size: int = 1024, n_workers: int = 8, d_vit: int = 1024, n_layers: int = 6, n_patches_per_img: int = 256, n_patches_per_shard: int = 2400000, seed: int = 42, ssl: bool = True, device: str = 'cuda', slurm: bool = False, slurm_acct: str = 'PAS2136', log_to: str = './logs')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for calculating and saving ViT activations.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Activations:
    &#34;&#34;&#34;
    Configuration for calculating and saving ViT activations.
    &#34;&#34;&#34;

    data: (
        ImagenetDataset
        | TreeOfLifeDataset
        | LaionDataset
        | Inat21Dataset
        | BrodenDataset
    ) = dataclasses.field(default_factory=ImagenetDataset)
    &#34;&#34;&#34;Which dataset to use.&#34;&#34;&#34;
    dump_to: str = os.path.join(&#34;.&#34;, &#34;shards&#34;)
    &#34;&#34;&#34;Where to write shards.&#34;&#34;&#34;
    model_org: typing.Literal[&#34;open-clip&#34;, &#34;timm&#34;, &#34;dinov2&#34;] = &#34;open-clip&#34;
    &#34;&#34;&#34;Where to load models from.&#34;&#34;&#34;
    model_ckpt: str = &#34;ViT-L-14/openai&#34;
    &#34;&#34;&#34;Specific model checkpoint.&#34;&#34;&#34;
    vit_batch_size: int = 1024
    &#34;&#34;&#34;Batch size for ViT inference.&#34;&#34;&#34;
    n_workers: int = 8
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    d_vit: int = 1024
    &#34;&#34;&#34;Dimension of the ViT activations (depends on model).&#34;&#34;&#34;
    n_layers: int = 6
    &#34;&#34;&#34;How many of the last ViT layers to save.&#34;&#34;&#34;
    n_patches_per_img: int = 256
    &#34;&#34;&#34;Number of ViT patches per image (depends on model).&#34;&#34;&#34;
    n_patches_per_shard: int = 2_400_000
    &#34;&#34;&#34;Number of activations per shard; 2.4M is approximately 10GB for 1024-dimensional 4-byte activations.&#34;&#34;&#34;

    seed: int = 42
    &#34;&#34;&#34;Random seed.&#34;&#34;&#34;
    ssl: bool = True
    &#34;&#34;&#34;Whether to use SSL.&#34;&#34;&#34;

    # Hardware
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;Which device to use.&#34;&#34;&#34;
    slurm: bool = False
    &#34;&#34;&#34;Whether to use `submitit` to run jobs on a Slurm cluster.&#34;&#34;&#34;
    slurm_acct: str = &#34;PAS2136&#34;
    &#34;&#34;&#34;Slurm account string.&#34;&#34;&#34;
    log_to: str = &#34;./logs&#34;
    &#34;&#34;&#34;Where to log Slurm job stdout/stderr.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Activations.d_vit"><code class="name">var <span class="ident">d_vit</span> : int</code></dt>
<dd>
<div class="desc"><p>Dimension of the ViT activations (depends on model).</p></div>
</dd>
<dt id="saev.config.Activations.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.TreeOfLifeDataset" href="#saev.config.TreeOfLifeDataset">TreeOfLifeDataset</a> | <a title="saev.config.LaionDataset" href="#saev.config.LaionDataset">LaionDataset</a> | <a title="saev.config.Inat21Dataset" href="#saev.config.Inat21Dataset">Inat21Dataset</a> | <a title="saev.config.BrodenDataset" href="#saev.config.BrodenDataset">BrodenDataset</a></code></dt>
<dd>
<div class="desc"><p>Which dataset to use.</p></div>
</dd>
<dt id="saev.config.Activations.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>Which device to use.</p></div>
</dd>
<dt id="saev.config.Activations.dump_to"><code class="name">var <span class="ident">dump_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to write shards.</p></div>
</dd>
<dt id="saev.config.Activations.log_to"><code class="name">var <span class="ident">log_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to log Slurm job stdout/stderr.</p></div>
</dd>
<dt id="saev.config.Activations.model_ckpt"><code class="name">var <span class="ident">model_ckpt</span> : str</code></dt>
<dd>
<div class="desc"><p>Specific model checkpoint.</p></div>
</dd>
<dt id="saev.config.Activations.model_org"><code class="name">var <span class="ident">model_org</span> : Literal['open-clip', 'timm', 'dinov2']</code></dt>
<dd>
<div class="desc"><p>Where to load models from.</p></div>
</dd>
<dt id="saev.config.Activations.n_layers"><code class="name">var <span class="ident">n_layers</span> : int</code></dt>
<dd>
<div class="desc"><p>How many of the last ViT layers to save.</p></div>
</dd>
<dt id="saev.config.Activations.n_patches_per_img"><code class="name">var <span class="ident">n_patches_per_img</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of ViT patches per image (depends on model).</p></div>
</dd>
<dt id="saev.config.Activations.n_patches_per_shard"><code class="name">var <span class="ident">n_patches_per_shard</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of activations per shard; 2.4M is approximately 10GB for 1024-dimensional 4-byte activations.</p></div>
</dd>
<dt id="saev.config.Activations.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.Activations.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>Random seed.</p></div>
</dd>
<dt id="saev.config.Activations.slurm"><code class="name">var <span class="ident">slurm</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use <code>submitit</code> to run jobs on a Slurm cluster.</p></div>
</dd>
<dt id="saev.config.Activations.slurm_acct"><code class="name">var <span class="ident">slurm_acct</span> : str</code></dt>
<dd>
<div class="desc"><p>Slurm account string.</p></div>
</dd>
<dt id="saev.config.Activations.ssl"><code class="name">var <span class="ident">ssl</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use SSL.</p></div>
</dd>
<dt id="saev.config.Activations.vit_batch_size"><code class="name">var <span class="ident">vit_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for ViT inference.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.BrodenDataset"><code class="flex name class">
<span>class <span class="ident">BrodenDataset</span></span>
<span>(</span><span>root: str = './broden')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for Broden dataset.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class BrodenDataset:
    &#34;&#34;&#34;Configuration for Broden dataset.&#34;&#34;&#34;

    root: str = os.path.join(&#34;.&#34;, &#34;broden&#34;)
    &#34;&#34;&#34;Where the Broden dataset is stored.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires reading a file. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
        with open(os.path.join(self.root, &#34;index.csv&#34;)) as fd:
            return sum(1 for _ in fd)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.BrodenDataset.root"><code class="name">var <span class="ident">root</span> : str</code></dt>
<dd>
<div class="desc"><p>Where the Broden dataset is stored.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.BrodenDataset.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires reading a file. If you need to reference this number very often, cache it in a local variable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires reading a file. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
    with open(os.path.join(self.root, &#34;index.csv&#34;)) as fd:
        return sum(1 for _ in fd)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.BrodenEvaluate"><code class="flex name class">
<span>class <span class="ident">BrodenEvaluate</span></span>
<span>(</span><span>ckpt: str = './checkpoints/abcdefg/sae.pt', patch_size: tuple[int, int] = (16, 16), root: str = './broden', data: <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a> = &lt;factory&gt;, n_workers: int = 8, batch_size: int = 1024, sample_range: tuple[int, int] = (200, 1000), dump_to: str = './logs/broden', device: str = 'cuda', log_every: int = 10, seed: int = 42)</span>
</code></dt>
<dd>
<div class="desc"><p>BrodenEvaluate(ckpt: str = './checkpoints/abcdefg/sae.pt', patch_size: tuple[int, int] = (16, 16), root: str = './broden', data: saev.config.DataLoad = <factory>, n_workers: int = 8, batch_size: int = 1024, sample_range: tuple[int, int] = (200, 1000), dump_to: str = './logs/broden', device: str = 'cuda', log_every: int = 10, seed: int = 42)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class BrodenEvaluate:
    ckpt: str = os.path.join(&#34;.&#34;, &#34;checkpoints&#34;, &#34;abcdefg&#34;, &#34;sae.pt&#34;)
    &#34;&#34;&#34;Path to the sae.pt file.&#34;&#34;&#34;
    patch_size: tuple[int, int] = (16, 16)
    &#34;&#34;&#34;Original patch size in pixels.&#34;&#34;&#34;
    root: str = &#34;./broden&#34;
    &#34;&#34;&#34;Root of the Broden dataset.&#34;&#34;&#34;
    data: DataLoad = dataclasses.field(default_factory=DataLoad)
    &#34;&#34;&#34;ViT activations for Broden.&#34;&#34;&#34;
    n_workers: int = 8
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    batch_size: int = 1024
    &#34;&#34;&#34;ViT and SAE inference batch size.&#34;&#34;&#34;
    sample_range: tuple[int, int] = (200, 1_000)
    &#34;&#34;&#34;Range of samples per label. Will skip samples with fewer samples and will truncate classes with more samples.&#34;&#34;&#34;
    dump_to: str = os.path.join(&#34;.&#34;, &#34;logs&#34;, &#34;broden&#34;)
    &#34;&#34;&#34;Where to save charts.&#34;&#34;&#34;
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;Which accelerator to use.&#34;&#34;&#34;
    log_every: int = 10
    &#34;&#34;&#34;How often to log progress.&#34;&#34;&#34;
    seed: int = 42
    &#34;&#34;&#34;Random seed.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.BrodenEvaluate.batch_size"><code class="name">var <span class="ident">batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>ViT and SAE inference batch size.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.ckpt"><code class="name">var <span class="ident">ckpt</span> : str</code></dt>
<dd>
<div class="desc"><p>Path to the sae.pt file.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></dt>
<dd>
<div class="desc"><p>ViT activations for Broden.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>Which accelerator to use.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.dump_to"><code class="name">var <span class="ident">dump_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to save charts.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.log_every"><code class="name">var <span class="ident">log_every</span> : int</code></dt>
<dd>
<div class="desc"><p>How often to log progress.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.patch_size"><code class="name">var <span class="ident">patch_size</span> : tuple[int, int]</code></dt>
<dd>
<div class="desc"><p>Original patch size in pixels.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.root"><code class="name">var <span class="ident">root</span> : str</code></dt>
<dd>
<div class="desc"><p>Root of the Broden dataset.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.sample_range"><code class="name">var <span class="ident">sample_range</span> : tuple[int, int]</code></dt>
<dd>
<div class="desc"><p>Range of samples per label. Will skip samples with fewer samples and will truncate classes with more samples.</p></div>
</dd>
<dt id="saev.config.BrodenEvaluate.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>Random seed.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.DataLoad"><code class="flex name class">
<span>class <span class="ident">DataLoad</span></span>
<span>(</span><span>shard_root: str = './shards', patches: Literal['cls', 'patches', 'meanpool'] = 'cls', layer: Union[int, Literal['all', 'meanpool']] = -1)</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for loading activation data from disk.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class DataLoad:
    &#34;&#34;&#34;
    Configuration for loading activation data from disk.
    &#34;&#34;&#34;

    shard_root: str = os.path.join(&#34;.&#34;, &#34;shards&#34;)
    &#34;&#34;&#34;Directory with .bin shards and a metadata.json file.&#34;&#34;&#34;
    patches: typing.Literal[&#34;cls&#34;, &#34;patches&#34;, &#34;meanpool&#34;] = &#34;cls&#34;
    &#34;&#34;&#34;Which kinds of patches to use. &#39;cls&#39; indicates just the [CLS] token (if any). &#39;patches&#39; indicates it will return all patches. &#39;meanpool&#39; returns the mean of all image patches.&#34;&#34;&#34;
    layer: int | typing.Literal[&#34;all&#34;, &#34;meanpool&#34;] = -1
    &#34;&#34;&#34;.. todo: document this field.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.DataLoad.layer"><code class="name">var <span class="ident">layer</span> : Union[int, Literal['all', 'meanpool']]</code></dt>
<dd>
<div class="desc"><p>.. todo: document this field.</p></div>
</dd>
<dt id="saev.config.DataLoad.patches"><code class="name">var <span class="ident">patches</span> : Literal['cls', 'patches', 'meanpool']</code></dt>
<dd>
<div class="desc"><p>Which kinds of patches to use. 'cls' indicates just the [CLS] token (if any). 'patches' indicates it will return all patches. 'meanpool' returns the mean of all image patches.</p></div>
</dd>
<dt id="saev.config.DataLoad.shard_root"><code class="name">var <span class="ident">shard_root</span> : str</code></dt>
<dd>
<div class="desc"><p>Directory with .bin shards and a metadata.json file.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.Evaluate"><code class="flex name class">
<span>class <span class="ident">Evaluate</span></span>
<span>(</span><span>histograms: <a title="saev.config.HistogramsEvaluate" href="#saev.config.HistogramsEvaluate">HistogramsEvaluate</a> = &lt;factory&gt;, broden: <a title="saev.config.BrodenEvaluate" href="#saev.config.BrodenEvaluate">BrodenEvaluate</a> = &lt;factory&gt;, imagenet: <a title="saev.config.ImagenetEvaluate" href="#saev.config.ImagenetEvaluate">ImagenetEvaluate</a> = &lt;factory&gt;, slurm: bool = False, slurm_acct: str = 'PAS2136', log_to: str = './logs')</span>
</code></dt>
<dd>
<div class="desc"><p>Evaluate(histograms: saev.config.HistogramsEvaluate = <factory>, broden: saev.config.BrodenEvaluate = <factory>, imagenet: saev.config.ImagenetEvaluate = <factory>, slurm: bool = False, slurm_acct: str = 'PAS2136', log_to: str = './logs')</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Evaluate:
    histograms: HistogramsEvaluate = dataclasses.field(
        default_factory=HistogramsEvaluate
    )
    &#34;&#34;&#34;Histogram config.&#34;&#34;&#34;
    broden: BrodenEvaluate = dataclasses.field(default_factory=BrodenEvaluate)
    &#34;&#34;&#34;Broden feature probing config.&#34;&#34;&#34;

    imagenet: ImagenetEvaluate = dataclasses.field(default_factory=ImagenetEvaluate)
    &#34;&#34;&#34;ImageNet-1K config.&#34;&#34;&#34;

    slurm: bool = False
    &#34;&#34;&#34;Whether to use `submitit` to run jobs on a Slurm cluster.&#34;&#34;&#34;
    slurm_acct: str = &#34;PAS2136&#34;
    &#34;&#34;&#34;Slurm account string.&#34;&#34;&#34;
    log_to: str = &#34;./logs&#34;
    &#34;&#34;&#34;Where to log Slurm job stdout/stderr.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Evaluate.broden"><code class="name">var <span class="ident">broden</span> : <a title="saev.config.BrodenEvaluate" href="#saev.config.BrodenEvaluate">BrodenEvaluate</a></code></dt>
<dd>
<div class="desc"><p>Broden feature probing config.</p></div>
</dd>
<dt id="saev.config.Evaluate.histograms"><code class="name">var <span class="ident">histograms</span> : <a title="saev.config.HistogramsEvaluate" href="#saev.config.HistogramsEvaluate">HistogramsEvaluate</a></code></dt>
<dd>
<div class="desc"><p>Histogram config.</p></div>
</dd>
<dt id="saev.config.Evaluate.imagenet"><code class="name">var <span class="ident">imagenet</span> : <a title="saev.config.ImagenetEvaluate" href="#saev.config.ImagenetEvaluate">ImagenetEvaluate</a></code></dt>
<dd>
<div class="desc"><p>ImageNet-1K config.</p></div>
</dd>
<dt id="saev.config.Evaluate.log_to"><code class="name">var <span class="ident">log_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to log Slurm job stdout/stderr.</p></div>
</dd>
<dt id="saev.config.Evaluate.slurm"><code class="name">var <span class="ident">slurm</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use <code>submitit</code> to run jobs on a Slurm cluster.</p></div>
</dd>
<dt id="saev.config.Evaluate.slurm_acct"><code class="name">var <span class="ident">slurm_acct</span> : str</code></dt>
<dd>
<div class="desc"><p>Slurm account string.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.HistogramsEvaluate"><code class="flex name class">
<span>class <span class="ident">HistogramsEvaluate</span></span>
<span>(</span><span>ckpt: str = './checkpoints/abcdefg/sae.pt', data: <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a> = &lt;factory&gt;, n_workers: int = 8, sae_batch_size: int = 8192, device: str = 'cuda', log_every: int = 10)</span>
</code></dt>
<dd>
<div class="desc"><p>HistogramsEvaluate(ckpt: str = './checkpoints/abcdefg/sae.pt', data: saev.config.DataLoad = <factory>, n_workers: int = 8, sae_batch_size: int = 8192, device: str = 'cuda', log_every: int = 10)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class HistogramsEvaluate:
    ckpt: str = os.path.join(&#34;.&#34;, &#34;checkpoints&#34;, &#34;abcdefg&#34;, &#34;sae.pt&#34;)
    &#34;&#34;&#34;Path to the sae.pt file.&#34;&#34;&#34;
    data: DataLoad = dataclasses.field(default_factory=DataLoad)
    &#34;&#34;&#34;Data configuration.&#34;&#34;&#34;
    n_workers: int = 8
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    sae_batch_size: int = 1024 * 8
    &#34;&#34;&#34;SAE inference batch size.&#34;&#34;&#34;
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;Which accelerator to use.&#34;&#34;&#34;
    log_every: int = 10
    &#34;&#34;&#34;How often to log progress.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.HistogramsEvaluate.ckpt"><code class="name">var <span class="ident">ckpt</span> : str</code></dt>
<dd>
<div class="desc"><p>Path to the sae.pt file.</p></div>
</dd>
<dt id="saev.config.HistogramsEvaluate.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></dt>
<dd>
<div class="desc"><p>Data configuration.</p></div>
</dd>
<dt id="saev.config.HistogramsEvaluate.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>Which accelerator to use.</p></div>
</dd>
<dt id="saev.config.HistogramsEvaluate.log_every"><code class="name">var <span class="ident">log_every</span> : int</code></dt>
<dd>
<div class="desc"><p>How often to log progress.</p></div>
</dd>
<dt id="saev.config.HistogramsEvaluate.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.HistogramsEvaluate.sae_batch_size"><code class="name">var <span class="ident">sae_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>SAE inference batch size.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.ImagenetDataset"><code class="flex name class">
<span>class <span class="ident">ImagenetDataset</span></span>
<span>(</span><span>name: str = 'ILSVRC/imagenet-1k', split: str = 'train')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for HuggingFace Imagenet.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class ImagenetDataset:
    &#34;&#34;&#34;Configuration for HuggingFace Imagenet.&#34;&#34;&#34;

    name: str = &#34;ILSVRC/imagenet-1k&#34;
    &#34;&#34;&#34;Dataset name on HuggingFace. Don&#39;t need to change this..&#34;&#34;&#34;
    split: str = &#34;train&#34;
    &#34;&#34;&#34;Dataset split. For the default ImageNet-1K dataset, can either be &#39;train&#39;, &#39;validation&#39; or &#39;test&#39;.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
        import datasets

        dataset = datasets.load_dataset(
            self.name, split=self.split, trust_remote_code=True
        )
        return len(dataset)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.ImagenetDataset.name"><code class="name">var <span class="ident">name</span> : str</code></dt>
<dd>
<div class="desc"><p>Dataset name on HuggingFace. Don't need to change this..</p></div>
</dd>
<dt id="saev.config.ImagenetDataset.split"><code class="name">var <span class="ident">split</span> : str</code></dt>
<dd>
<div class="desc"><p>Dataset split. For the default ImageNet-1K dataset, can either be 'train', 'validation' or 'test'.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.ImagenetDataset.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
    import datasets

    dataset = datasets.load_dataset(
        self.name, split=self.split, trust_remote_code=True
    )
    return len(dataset)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.ImagenetEvaluate"><code class="flex name class">
<span>class <span class="ident">ImagenetEvaluate</span></span>
<span>(</span><span>ckpt: str = './checkpoints/abcdefg', train_shard_root: str = './imagenet-1k-shards/train', val_shard_root: str = './imagenet-1k-shards/val', n_workers: int = 16, sgd_batch_size: int = 16384, n_steps: int = 12500, device: str = 'cuda', log_every: int = 5)</span>
</code></dt>
<dd>
<div class="desc"><p>ImagenetEvaluate(ckpt: str = './checkpoints/abcdefg', train_shard_root: str = './imagenet-1k-shards/train', val_shard_root: str = './imagenet-1k-shards/val', n_workers: int = 16, sgd_batch_size: int = 16384, n_steps: int = 12500, device: str = 'cuda', log_every: int = 5)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class ImagenetEvaluate:
    # Model
    ckpt: str = os.path.join(&#34;.&#34;, &#34;checkpoints&#34;, &#34;abcdefg&#34;)
    &#34;&#34;&#34;Path to the sae.pt file.&#34;&#34;&#34;
    # Data
    train_shard_root: str = os.path.join(&#34;.&#34;, &#34;imagenet-1k-shards&#34;, &#34;train&#34;)
    &#34;&#34;&#34;Train shards root directory.&#34;&#34;&#34;
    val_shard_root: str = os.path.join(&#34;.&#34;, &#34;imagenet-1k-shards&#34;, &#34;val&#34;)
    &#34;&#34;&#34;Validation shards root directory.&#34;&#34;&#34;
    n_workers: int = 16
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    # Optimization
    sgd_batch_size: int = 1024 * 16
    &#34;&#34;&#34;Batch size for linear classifier.&#34;&#34;&#34;
    n_steps: int = 12500
    &#34;&#34;&#34;Number of SGD steps.&#34;&#34;&#34;
    # Hardware
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;Which accelerator to use.&#34;&#34;&#34;
    # Misc
    log_every: int = 5
    &#34;&#34;&#34;How often to log progress.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.ImagenetEvaluate.ckpt"><code class="name">var <span class="ident">ckpt</span> : str</code></dt>
<dd>
<div class="desc"><p>Path to the sae.pt file.</p></div>
</dd>
<dt id="saev.config.ImagenetEvaluate.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>Which accelerator to use.</p></div>
</dd>
<dt id="saev.config.ImagenetEvaluate.log_every"><code class="name">var <span class="ident">log_every</span> : int</code></dt>
<dd>
<div class="desc"><p>How often to log progress.</p></div>
</dd>
<dt id="saev.config.ImagenetEvaluate.n_steps"><code class="name">var <span class="ident">n_steps</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of SGD steps.</p></div>
</dd>
<dt id="saev.config.ImagenetEvaluate.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.ImagenetEvaluate.sgd_batch_size"><code class="name">var <span class="ident">sgd_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for linear classifier.</p></div>
</dd>
<dt id="saev.config.ImagenetEvaluate.train_shard_root"><code class="name">var <span class="ident">train_shard_root</span> : str</code></dt>
<dd>
<div class="desc"><p>Train shards root directory.</p></div>
</dd>
<dt id="saev.config.ImagenetEvaluate.val_shard_root"><code class="name">var <span class="ident">val_shard_root</span> : str</code></dt>
<dd>
<div class="desc"><p>Validation shards root directory.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.Inat21Dataset"><code class="flex name class">
<span>class <span class="ident">Inat21Dataset</span></span>
<span>(</span><span>root: str = './inat21', split: str = 'train')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for iNat2021 dataset.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Inat21Dataset:
    &#34;&#34;&#34;Configuration for iNat2021 dataset.&#34;&#34;&#34;

    root: str = &#34;./inat21&#34;
    &#34;&#34;&#34;Where the images are stored.&#34;&#34;&#34;
    split: str = &#34;train&#34;
    &#34;&#34;&#34;Dataset split. Can either be &#39;train&#39;, &#39;val&#39; or &#39;train_mini&#39;.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires walking the directory structure. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
        n = 0
        for _, _, files in os.walk(os.path.join(self.root, self.split)):
            n += len(files)
        return n</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Inat21Dataset.root"><code class="name">var <span class="ident">root</span> : str</code></dt>
<dd>
<div class="desc"><p>Where the images are stored.</p></div>
</dd>
<dt id="saev.config.Inat21Dataset.split"><code class="name">var <span class="ident">split</span> : str</code></dt>
<dd>
<div class="desc"><p>Dataset split. Can either be 'train', 'val' or 'train_mini'.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.Inat21Dataset.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires walking the directory structure. If you need to reference this number very often, cache it in a local variable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires walking the directory structure. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
    n = 0
    for _, _, files in os.walk(os.path.join(self.root, self.split)):
        n += len(files)
    return n</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.LaionDataset"><code class="flex name class">
<span>class <span class="ident">LaionDataset</span></span>
<span>(</span><span>name: str = 'laion/relaion2B-multi-research-safe', cache_dir: str = '/fs/scratch/PAS2136/samuelstevens/cache/laion', n_imgs: int = 10000000)</span>
</code></dt>
<dd>
<div class="desc"><p>LaionDataset(name: str = 'laion/relaion2B-multi-research-safe', cache_dir: str = '/fs/scratch/PAS2136/samuelstevens/cache/laion', n_imgs: int = 10000000)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class LaionDataset:
    name: str = &#34;laion/relaion2B-multi-research-safe&#34;
    &#34;&#34;&#34;Name of dataset on HuggingFace.&#34;&#34;&#34;
    cache_dir: str = &#34;/fs/scratch/PAS2136/samuelstevens/cache/laion&#34;
    &#34;&#34;&#34;Where to save the webdataset files that are downloaded.&#34;&#34;&#34;
    n_imgs: int = 10_000_000
    &#34;&#34;&#34;Number of images in this dataset (fixed at 10M).&#34;&#34;&#34;

    @property
    def url_list_filepath(self) -&gt; str:
        &#34;&#34;&#34;Path to file with list of URLs.&#34;&#34;&#34;
        return os.path.join(self.cache_dir, &#34;urls.jsonl&#34;)

    @property
    def tar_dir(self) -&gt; str:
        return os.path.join(self.cache_dir, &#34;shards&#34;)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.LaionDataset.cache_dir"><code class="name">var <span class="ident">cache_dir</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to save the webdataset files that are downloaded.</p></div>
</dd>
<dt id="saev.config.LaionDataset.n_imgs"><code class="name">var <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of images in this dataset (fixed at 10M).</p></div>
</dd>
<dt id="saev.config.LaionDataset.name"><code class="name">var <span class="ident">name</span> : str</code></dt>
<dd>
<div class="desc"><p>Name of dataset on HuggingFace.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.LaionDataset.tar_dir"><code class="name">prop <span class="ident">tar_dir</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def tar_dir(self) -&gt; str:
    return os.path.join(self.cache_dir, &#34;shards&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.LaionDataset.url_list_filepath"><code class="name">prop <span class="ident">url_list_filepath</span> : str</code></dt>
<dd>
<div class="desc"><p>Path to file with list of URLs.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def url_list_filepath(self) -&gt; str:
    &#34;&#34;&#34;Path to file with list of URLs.&#34;&#34;&#34;
    return os.path.join(self.cache_dir, &#34;urls.jsonl&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.Train"><code class="flex name class">
<span>class <span class="ident">Train</span></span>
<span>(</span><span>data: <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a> = &lt;factory&gt;, n_workers: int = 8, n_reinit_batches: int = 15, n_patches: int = 1000000000, exp_factor: int = 64, l1_coeff: float = 8e-05, lr: float = 0.0004, n_lr_warmup: int = 500, sae_batch_size: int = 1024, use_ghost_grads: bool = True, feature_sampling_window: int = 64, resample_batches: int = 32, dead_feature_window: int = 64, dead_feature_threshold: float = 1e-06, track: bool = True, wandb_project: str = 'saev', log_every: int = 25, ckpt_path: str = './checkpoints', device: str = 'cuda', seed: int = 42, slurm: bool = False, slurm_acct: str = 'PAS2136', log_to: str = './logs')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for training a sparse autoencoder on a vision transformer.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Train:
    &#34;&#34;&#34;
    Configuration for training a sparse autoencoder on a vision transformer.
    &#34;&#34;&#34;

    data: DataLoad = dataclasses.field(default_factory=DataLoad)
    &#34;&#34;&#34;Data configuration&#34;&#34;&#34;
    n_workers: int = 8
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;

    # Training
    n_reinit_batches: int = 15
    &#34;&#34;&#34;Number of batches to use for SAE re-init.&#34;&#34;&#34;
    n_patches: int = 1_000_000_000
    &#34;&#34;&#34;Number of SAE training examples.&#34;&#34;&#34;
    exp_factor: int = 64
    &#34;&#34;&#34;Expansion factor for SAE.&#34;&#34;&#34;
    l1_coeff: float = 0.00008

    lr: float = 0.0004
    &#34;&#34;&#34;Learning rate.&#34;&#34;&#34;
    n_lr_warmup: int = 500
    &#34;&#34;&#34;Number of learning rate warmup steps.&#34;&#34;&#34;
    sae_batch_size: int = 1024
    &#34;&#34;&#34;Batch size for SAE training.&#34;&#34;&#34;

    use_ghost_grads: bool = True

    feature_sampling_window: int = 64

    resample_batches: int = 32

    dead_feature_window: int = 64

    dead_feature_threshold: float = 1e-6

    # Logging
    track: bool = True
    &#34;&#34;&#34;Whether to track with WandB.&#34;&#34;&#34;
    wandb_project: str = &#34;saev&#34;

    log_every: int = 25
    &#34;&#34;&#34;How often to log to WandB.&#34;&#34;&#34;
    ckpt_path: str = os.path.join(&#34;.&#34;, &#34;checkpoints&#34;)
    &#34;&#34;&#34;Where to save checkpoints.&#34;&#34;&#34;

    # Misc.
    device: str = &#34;cuda&#34;

    seed: int = 42
    &#34;&#34;&#34;Random seed.&#34;&#34;&#34;

    slurm: bool = False
    &#34;&#34;&#34;Whether to use `submitit` to run jobs on a Slurm cluster.&#34;&#34;&#34;
    slurm_acct: str = &#34;PAS2136&#34;
    &#34;&#34;&#34;Slurm account string.&#34;&#34;&#34;
    log_to: str = os.path.join(&#34;.&#34;, &#34;logs&#34;)
    &#34;&#34;&#34;Where to log Slurm job stdout/stderr.&#34;&#34;&#34;

    @property
    def reinit_size(self) -&gt; int:
        return self.n_reinit_batches * self.sae_batch_size</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Train.ckpt_path"><code class="name">var <span class="ident">ckpt_path</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to save checkpoints.</p></div>
</dd>
<dt id="saev.config.Train.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></dt>
<dd>
<div class="desc"><p>Data configuration</p></div>
</dd>
<dt id="saev.config.Train.dead_feature_threshold"><code class="name">var <span class="ident">dead_feature_threshold</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Train.dead_feature_window"><code class="name">var <span class="ident">dead_feature_window</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Train.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Train.exp_factor"><code class="name">var <span class="ident">exp_factor</span> : int</code></dt>
<dd>
<div class="desc"><p>Expansion factor for SAE.</p></div>
</dd>
<dt id="saev.config.Train.feature_sampling_window"><code class="name">var <span class="ident">feature_sampling_window</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Train.l1_coeff"><code class="name">var <span class="ident">l1_coeff</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Train.log_every"><code class="name">var <span class="ident">log_every</span> : int</code></dt>
<dd>
<div class="desc"><p>How often to log to WandB.</p></div>
</dd>
<dt id="saev.config.Train.log_to"><code class="name">var <span class="ident">log_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to log Slurm job stdout/stderr.</p></div>
</dd>
<dt id="saev.config.Train.lr"><code class="name">var <span class="ident">lr</span> : float</code></dt>
<dd>
<div class="desc"><p>Learning rate.</p></div>
</dd>
<dt id="saev.config.Train.n_lr_warmup"><code class="name">var <span class="ident">n_lr_warmup</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of learning rate warmup steps.</p></div>
</dd>
<dt id="saev.config.Train.n_patches"><code class="name">var <span class="ident">n_patches</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of SAE training examples.</p></div>
</dd>
<dt id="saev.config.Train.n_reinit_batches"><code class="name">var <span class="ident">n_reinit_batches</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of batches to use for SAE re-init.</p></div>
</dd>
<dt id="saev.config.Train.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.Train.resample_batches"><code class="name">var <span class="ident">resample_batches</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Train.sae_batch_size"><code class="name">var <span class="ident">sae_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for SAE training.</p></div>
</dd>
<dt id="saev.config.Train.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>Random seed.</p></div>
</dd>
<dt id="saev.config.Train.slurm"><code class="name">var <span class="ident">slurm</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use <code>submitit</code> to run jobs on a Slurm cluster.</p></div>
</dd>
<dt id="saev.config.Train.slurm_acct"><code class="name">var <span class="ident">slurm_acct</span> : str</code></dt>
<dd>
<div class="desc"><p>Slurm account string.</p></div>
</dd>
<dt id="saev.config.Train.track"><code class="name">var <span class="ident">track</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to track with WandB.</p></div>
</dd>
<dt id="saev.config.Train.use_ghost_grads"><code class="name">var <span class="ident">use_ghost_grads</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.Train.wandb_project"><code class="name">var <span class="ident">wandb_project</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.Train.reinit_size"><code class="name">prop <span class="ident">reinit_size</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def reinit_size(self) -&gt; int:
    return self.n_reinit_batches * self.sae_batch_size</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.TreeOfLifeDataset"><code class="flex name class">
<span>class <span class="ident">TreeOfLifeDataset</span></span>
<span>(</span><span>metadata: str = 'treeoflife-10m.json', label_key: str = '.taxonomic_name.txt')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for the TreeOfLife-10M webdataset.</p>
<p>Webdatasets are designed for random sampling of the entire dataset so that over multiple epochs, every sample is seen, on average, the same number of times. However, for training sparse autoencoders, we need to calculate ViT activations exactly once for each example in the dataset. Webdatasets support this through the <a href="https://github.com/webdataset/webdataset?tab=readme-ov-file#the-wids-library-for-indexed-webdatasets"><code>wids</code></a> library.</p>
<p>Here is a short discussion of the steps required to use saev with webdatasets.</p>
<p>First, you will need to use <code>widsindex</code> (installed with the webdataset library) to create an metadata file used by wids. You can see an example file <a href="https://storage.googleapis.com/webdataset/fake-imagenet/imagenet-train.json">here</a>. To generate my own metadata file, I ran this command:</p>
<pre><code class="language-sh">uv run widsindex create --name treeoflife-10m --output treeoflife-10m.json '/fs/ess/PAS2136/open_clip/data/evobio10m-v3.3/224x224/train/shard-{000000..000159}.tar'
</code></pre>
<p>It took a long time (more than an hour, less than 3 hours) and generated a <code>treeoflife-10m.json</code> file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class TreeOfLifeDataset:
    &#34;&#34;&#34;
    Configuration for the TreeOfLife-10M webdataset.

    Webdatasets are designed for random sampling of the entire dataset so that over multiple epochs, every sample is seen, on average, the same number of times. However, for training sparse autoencoders, we need to calculate ViT activations exactly once for each example in the dataset. Webdatasets support this through the [`wids`](https://github.com/webdataset/webdataset?tab=readme-ov-file#the-wids-library-for-indexed-webdatasets) library.

    Here is a short discussion of the steps required to use saev with webdatasets.

    First, you will need to use `widsindex` (installed with the webdataset library) to create an metadata file used by wids. You can see an example file [here](https://storage.googleapis.com/webdataset/fake-imagenet/imagenet-train.json). To generate my own metadata file, I ran this command:

    ```sh
    uv run widsindex create --name treeoflife-10m --output treeoflife-10m.json &#39;/fs/ess/PAS2136/open_clip/data/evobio10m-v3.3/224x224/train/shard-{000000..000159}.tar&#39;
    ```

    It took a long time (more than an hour, less than 3 hours) and generated a `treeoflife-10m.json` file.
    &#34;&#34;&#34;

    metadata: str = &#34;treeoflife-10m.json&#34;
    &#34;&#34;&#34;&#34;&#34;&#34;
    label_key: str = &#34;.taxonomic_name.txt&#34;
    &#34;&#34;&#34;Which key to use as the label.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Return number of images in the dataset by reading the metadata file and summing the `nsamples` fields.&#34;&#34;&#34;
        import json

        import numpy as np

        with open(self.metadata) as fd:
            metadata = json.load(fd)

        return (
            np.array([shard[&#34;nsamples&#34;] for shard in metadata[&#34;shardlist&#34;]])
            .sum()
            .item()
        )</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.TreeOfLifeDataset.label_key"><code class="name">var <span class="ident">label_key</span> : str</code></dt>
<dd>
<div class="desc"><p>Which key to use as the label.</p></div>
</dd>
<dt id="saev.config.TreeOfLifeDataset.metadata"><code class="name">var <span class="ident">metadata</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.TreeOfLifeDataset.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Return number of images in the dataset by reading the metadata file and summing the <code>nsamples</code> fields.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Return number of images in the dataset by reading the metadata file and summing the `nsamples` fields.&#34;&#34;&#34;
    import json

    import numpy as np

    with open(self.metadata) as fd:
        metadata = json.load(fd)

    return (
        np.array([shard[&#34;nsamples&#34;] for shard in metadata[&#34;shardlist&#34;]])
        .sum()
        .item()
    )</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.Webapp"><code class="flex name class">
<span>class <span class="ident">Webapp</span></span>
<span>(</span><span>ckpt: str = './checkpoints/sae.pt', data: <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a> = &lt;factory&gt;, images: <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.TreeOfLifeDataset" href="#saev.config.TreeOfLifeDataset">TreeOfLifeDataset</a> | <a title="saev.config.LaionDataset" href="#saev.config.LaionDataset">LaionDataset</a> | <a title="saev.config.Inat21Dataset" href="#saev.config.Inat21Dataset">Inat21Dataset</a> = &lt;factory&gt;, top_k: int = 16, n_workers: int = 16, topk_batch_size: int = 16384, sae_batch_size: int = 1024, epsilon: float = 1e-09, sort_by: Literal['cls', 'img', 'patch'] = 'cls', device: str = 'cuda', dump_to: str = './data')</span>
</code></dt>
<dd>
<div class="desc"><div class="admonition todo">
<p class="admonition-title">TODO</p>
<p>document.</p>
</div></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Webapp:
    &#34;&#34;&#34;.. todo:: document.&#34;&#34;&#34;

    ckpt: str = os.path.join(&#34;.&#34;, &#34;checkpoints&#34;, &#34;sae.pt&#34;)
    &#34;&#34;&#34;Path to the sae.pt file.&#34;&#34;&#34;
    data: DataLoad = dataclasses.field(default_factory=DataLoad)
    &#34;&#34;&#34;Data configuration.&#34;&#34;&#34;
    images: ImagenetDataset | TreeOfLifeDataset | LaionDataset | Inat21Dataset = (
        dataclasses.field(default_factory=ImagenetDataset)
    )
    &#34;&#34;&#34;Which images to use.&#34;&#34;&#34;
    top_k: int = 16
    &#34;&#34;&#34;How many images per SAE feature to store.&#34;&#34;&#34;
    n_workers: int = 16
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    topk_batch_size: int = 1024 * 16
    &#34;&#34;&#34;Number of examples to apply top-k op to.&#34;&#34;&#34;
    sae_batch_size: int = 1024
    &#34;&#34;&#34;Batch size for SAE inference.&#34;&#34;&#34;
    epsilon: float = 1e-9
    &#34;&#34;&#34;Value to add to avoid log(0).&#34;&#34;&#34;
    sort_by: typing.Literal[&#34;cls&#34;, &#34;img&#34;, &#34;patch&#34;] = &#34;cls&#34;
    &#34;&#34;&#34;How to find the top k images. &#39;cls&#39; picks images where the SAE latents of the ViT&#39;s [CLS] token are maximized without any patch highligting. &#39;img&#39; picks images that maximize the sum of an SAE latent over all patches in the image, highlighting the patches. &#39;patch&#39; pickes images that maximize an SAE latent over all patches (not summed), highlighting the patches and only showing unique images.&#34;&#34;&#34;
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;Which accelerator to use.&#34;&#34;&#34;
    dump_to: str = os.path.join(&#34;.&#34;, &#34;data&#34;)
    &#34;&#34;&#34;Where to save data.&#34;&#34;&#34;

    @property
    def root(self) -&gt; str:
        return os.path.join(self.dump_to, f&#34;sort_by_{self.sort_by}&#34;)

    @property
    def top_values_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;top_values.pt&#34;)

    @property
    def top_img_i_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;top_img_i.pt&#34;)

    @property
    def top_patch_i_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;top_patch_i.pt&#34;)

    @property
    def mean_values_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;mean_values.pt&#34;)

    @property
    def sparsity_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;sparsity.pt&#34;)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Webapp.ckpt"><code class="name">var <span class="ident">ckpt</span> : str</code></dt>
<dd>
<div class="desc"><p>Path to the sae.pt file.</p></div>
</dd>
<dt id="saev.config.Webapp.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></dt>
<dd>
<div class="desc"><p>Data configuration.</p></div>
</dd>
<dt id="saev.config.Webapp.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>Which accelerator to use.</p></div>
</dd>
<dt id="saev.config.Webapp.dump_to"><code class="name">var <span class="ident">dump_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to save data.</p></div>
</dd>
<dt id="saev.config.Webapp.epsilon"><code class="name">var <span class="ident">epsilon</span> : float</code></dt>
<dd>
<div class="desc"><p>Value to add to avoid log(0).</p></div>
</dd>
<dt id="saev.config.Webapp.images"><code class="name">var <span class="ident">images</span> : <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.TreeOfLifeDataset" href="#saev.config.TreeOfLifeDataset">TreeOfLifeDataset</a> | <a title="saev.config.LaionDataset" href="#saev.config.LaionDataset">LaionDataset</a> | <a title="saev.config.Inat21Dataset" href="#saev.config.Inat21Dataset">Inat21Dataset</a></code></dt>
<dd>
<div class="desc"><p>Which images to use.</p></div>
</dd>
<dt id="saev.config.Webapp.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.Webapp.sae_batch_size"><code class="name">var <span class="ident">sae_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for SAE inference.</p></div>
</dd>
<dt id="saev.config.Webapp.sort_by"><code class="name">var <span class="ident">sort_by</span> : Literal['cls', 'img', 'patch']</code></dt>
<dd>
<div class="desc"><p>How to find the top k images. 'cls' picks images where the SAE latents of the ViT's [CLS] token are maximized without any patch highligting. 'img' picks images that maximize the sum of an SAE latent over all patches in the image, highlighting the patches. 'patch' pickes images that maximize an SAE latent over all patches (not summed), highlighting the patches and only showing unique images.</p></div>
</dd>
<dt id="saev.config.Webapp.top_k"><code class="name">var <span class="ident">top_k</span> : int</code></dt>
<dd>
<div class="desc"><p>How many images per SAE feature to store.</p></div>
</dd>
<dt id="saev.config.Webapp.topk_batch_size"><code class="name">var <span class="ident">topk_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of examples to apply top-k op to.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.Webapp.mean_values_fpath"><code class="name">prop <span class="ident">mean_values_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def mean_values_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;mean_values.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Webapp.root"><code class="name">prop <span class="ident">root</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def root(self) -&gt; str:
    return os.path.join(self.dump_to, f&#34;sort_by_{self.sort_by}&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Webapp.sparsity_fpath"><code class="name">prop <span class="ident">sparsity_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def sparsity_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;sparsity.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Webapp.top_img_i_fpath"><code class="name">prop <span class="ident">top_img_i_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def top_img_i_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;top_img_i.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Webapp.top_patch_i_fpath"><code class="name">prop <span class="ident">top_patch_i_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def top_patch_i_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;top_patch_i.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Webapp.top_values_fpath"><code class="name">prop <span class="ident">top_values_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def top_values_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;top_values.pt&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#import-times">Import Times</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="saev" href="index.html">saev</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="saev.config.Activations" href="#saev.config.Activations">Activations</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.Activations.d_vit" href="#saev.config.Activations.d_vit">d_vit</a></code></li>
<li><code><a title="saev.config.Activations.data" href="#saev.config.Activations.data">data</a></code></li>
<li><code><a title="saev.config.Activations.device" href="#saev.config.Activations.device">device</a></code></li>
<li><code><a title="saev.config.Activations.dump_to" href="#saev.config.Activations.dump_to">dump_to</a></code></li>
<li><code><a title="saev.config.Activations.log_to" href="#saev.config.Activations.log_to">log_to</a></code></li>
<li><code><a title="saev.config.Activations.model_ckpt" href="#saev.config.Activations.model_ckpt">model_ckpt</a></code></li>
<li><code><a title="saev.config.Activations.model_org" href="#saev.config.Activations.model_org">model_org</a></code></li>
<li><code><a title="saev.config.Activations.n_layers" href="#saev.config.Activations.n_layers">n_layers</a></code></li>
<li><code><a title="saev.config.Activations.n_patches_per_img" href="#saev.config.Activations.n_patches_per_img">n_patches_per_img</a></code></li>
<li><code><a title="saev.config.Activations.n_patches_per_shard" href="#saev.config.Activations.n_patches_per_shard">n_patches_per_shard</a></code></li>
<li><code><a title="saev.config.Activations.n_workers" href="#saev.config.Activations.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.Activations.seed" href="#saev.config.Activations.seed">seed</a></code></li>
<li><code><a title="saev.config.Activations.slurm" href="#saev.config.Activations.slurm">slurm</a></code></li>
<li><code><a title="saev.config.Activations.slurm_acct" href="#saev.config.Activations.slurm_acct">slurm_acct</a></code></li>
<li><code><a title="saev.config.Activations.ssl" href="#saev.config.Activations.ssl">ssl</a></code></li>
<li><code><a title="saev.config.Activations.vit_batch_size" href="#saev.config.Activations.vit_batch_size">vit_batch_size</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.BrodenDataset" href="#saev.config.BrodenDataset">BrodenDataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.BrodenDataset.n_imgs" href="#saev.config.BrodenDataset.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.BrodenDataset.root" href="#saev.config.BrodenDataset.root">root</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.BrodenEvaluate" href="#saev.config.BrodenEvaluate">BrodenEvaluate</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.BrodenEvaluate.batch_size" href="#saev.config.BrodenEvaluate.batch_size">batch_size</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.ckpt" href="#saev.config.BrodenEvaluate.ckpt">ckpt</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.data" href="#saev.config.BrodenEvaluate.data">data</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.device" href="#saev.config.BrodenEvaluate.device">device</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.dump_to" href="#saev.config.BrodenEvaluate.dump_to">dump_to</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.log_every" href="#saev.config.BrodenEvaluate.log_every">log_every</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.n_workers" href="#saev.config.BrodenEvaluate.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.patch_size" href="#saev.config.BrodenEvaluate.patch_size">patch_size</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.root" href="#saev.config.BrodenEvaluate.root">root</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.sample_range" href="#saev.config.BrodenEvaluate.sample_range">sample_range</a></code></li>
<li><code><a title="saev.config.BrodenEvaluate.seed" href="#saev.config.BrodenEvaluate.seed">seed</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></h4>
<ul class="">
<li><code><a title="saev.config.DataLoad.layer" href="#saev.config.DataLoad.layer">layer</a></code></li>
<li><code><a title="saev.config.DataLoad.patches" href="#saev.config.DataLoad.patches">patches</a></code></li>
<li><code><a title="saev.config.DataLoad.shard_root" href="#saev.config.DataLoad.shard_root">shard_root</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Evaluate" href="#saev.config.Evaluate">Evaluate</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.Evaluate.broden" href="#saev.config.Evaluate.broden">broden</a></code></li>
<li><code><a title="saev.config.Evaluate.histograms" href="#saev.config.Evaluate.histograms">histograms</a></code></li>
<li><code><a title="saev.config.Evaluate.imagenet" href="#saev.config.Evaluate.imagenet">imagenet</a></code></li>
<li><code><a title="saev.config.Evaluate.log_to" href="#saev.config.Evaluate.log_to">log_to</a></code></li>
<li><code><a title="saev.config.Evaluate.slurm" href="#saev.config.Evaluate.slurm">slurm</a></code></li>
<li><code><a title="saev.config.Evaluate.slurm_acct" href="#saev.config.Evaluate.slurm_acct">slurm_acct</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.HistogramsEvaluate" href="#saev.config.HistogramsEvaluate">HistogramsEvaluate</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.HistogramsEvaluate.ckpt" href="#saev.config.HistogramsEvaluate.ckpt">ckpt</a></code></li>
<li><code><a title="saev.config.HistogramsEvaluate.data" href="#saev.config.HistogramsEvaluate.data">data</a></code></li>
<li><code><a title="saev.config.HistogramsEvaluate.device" href="#saev.config.HistogramsEvaluate.device">device</a></code></li>
<li><code><a title="saev.config.HistogramsEvaluate.log_every" href="#saev.config.HistogramsEvaluate.log_every">log_every</a></code></li>
<li><code><a title="saev.config.HistogramsEvaluate.n_workers" href="#saev.config.HistogramsEvaluate.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.HistogramsEvaluate.sae_batch_size" href="#saev.config.HistogramsEvaluate.sae_batch_size">sae_batch_size</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.ImagenetDataset.n_imgs" href="#saev.config.ImagenetDataset.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.ImagenetDataset.name" href="#saev.config.ImagenetDataset.name">name</a></code></li>
<li><code><a title="saev.config.ImagenetDataset.split" href="#saev.config.ImagenetDataset.split">split</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.ImagenetEvaluate" href="#saev.config.ImagenetEvaluate">ImagenetEvaluate</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.ImagenetEvaluate.ckpt" href="#saev.config.ImagenetEvaluate.ckpt">ckpt</a></code></li>
<li><code><a title="saev.config.ImagenetEvaluate.device" href="#saev.config.ImagenetEvaluate.device">device</a></code></li>
<li><code><a title="saev.config.ImagenetEvaluate.log_every" href="#saev.config.ImagenetEvaluate.log_every">log_every</a></code></li>
<li><code><a title="saev.config.ImagenetEvaluate.n_steps" href="#saev.config.ImagenetEvaluate.n_steps">n_steps</a></code></li>
<li><code><a title="saev.config.ImagenetEvaluate.n_workers" href="#saev.config.ImagenetEvaluate.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.ImagenetEvaluate.sgd_batch_size" href="#saev.config.ImagenetEvaluate.sgd_batch_size">sgd_batch_size</a></code></li>
<li><code><a title="saev.config.ImagenetEvaluate.train_shard_root" href="#saev.config.ImagenetEvaluate.train_shard_root">train_shard_root</a></code></li>
<li><code><a title="saev.config.ImagenetEvaluate.val_shard_root" href="#saev.config.ImagenetEvaluate.val_shard_root">val_shard_root</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Inat21Dataset" href="#saev.config.Inat21Dataset">Inat21Dataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.Inat21Dataset.n_imgs" href="#saev.config.Inat21Dataset.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.Inat21Dataset.root" href="#saev.config.Inat21Dataset.root">root</a></code></li>
<li><code><a title="saev.config.Inat21Dataset.split" href="#saev.config.Inat21Dataset.split">split</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.LaionDataset" href="#saev.config.LaionDataset">LaionDataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.LaionDataset.cache_dir" href="#saev.config.LaionDataset.cache_dir">cache_dir</a></code></li>
<li><code><a title="saev.config.LaionDataset.n_imgs" href="#saev.config.LaionDataset.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.LaionDataset.name" href="#saev.config.LaionDataset.name">name</a></code></li>
<li><code><a title="saev.config.LaionDataset.tar_dir" href="#saev.config.LaionDataset.tar_dir">tar_dir</a></code></li>
<li><code><a title="saev.config.LaionDataset.url_list_filepath" href="#saev.config.LaionDataset.url_list_filepath">url_list_filepath</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Train" href="#saev.config.Train">Train</a></code></h4>
<ul class="">
<li><code><a title="saev.config.Train.ckpt_path" href="#saev.config.Train.ckpt_path">ckpt_path</a></code></li>
<li><code><a title="saev.config.Train.data" href="#saev.config.Train.data">data</a></code></li>
<li><code><a title="saev.config.Train.dead_feature_threshold" href="#saev.config.Train.dead_feature_threshold">dead_feature_threshold</a></code></li>
<li><code><a title="saev.config.Train.dead_feature_window" href="#saev.config.Train.dead_feature_window">dead_feature_window</a></code></li>
<li><code><a title="saev.config.Train.device" href="#saev.config.Train.device">device</a></code></li>
<li><code><a title="saev.config.Train.exp_factor" href="#saev.config.Train.exp_factor">exp_factor</a></code></li>
<li><code><a title="saev.config.Train.feature_sampling_window" href="#saev.config.Train.feature_sampling_window">feature_sampling_window</a></code></li>
<li><code><a title="saev.config.Train.l1_coeff" href="#saev.config.Train.l1_coeff">l1_coeff</a></code></li>
<li><code><a title="saev.config.Train.log_every" href="#saev.config.Train.log_every">log_every</a></code></li>
<li><code><a title="saev.config.Train.log_to" href="#saev.config.Train.log_to">log_to</a></code></li>
<li><code><a title="saev.config.Train.lr" href="#saev.config.Train.lr">lr</a></code></li>
<li><code><a title="saev.config.Train.n_lr_warmup" href="#saev.config.Train.n_lr_warmup">n_lr_warmup</a></code></li>
<li><code><a title="saev.config.Train.n_patches" href="#saev.config.Train.n_patches">n_patches</a></code></li>
<li><code><a title="saev.config.Train.n_reinit_batches" href="#saev.config.Train.n_reinit_batches">n_reinit_batches</a></code></li>
<li><code><a title="saev.config.Train.n_workers" href="#saev.config.Train.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.Train.reinit_size" href="#saev.config.Train.reinit_size">reinit_size</a></code></li>
<li><code><a title="saev.config.Train.resample_batches" href="#saev.config.Train.resample_batches">resample_batches</a></code></li>
<li><code><a title="saev.config.Train.sae_batch_size" href="#saev.config.Train.sae_batch_size">sae_batch_size</a></code></li>
<li><code><a title="saev.config.Train.seed" href="#saev.config.Train.seed">seed</a></code></li>
<li><code><a title="saev.config.Train.slurm" href="#saev.config.Train.slurm">slurm</a></code></li>
<li><code><a title="saev.config.Train.slurm_acct" href="#saev.config.Train.slurm_acct">slurm_acct</a></code></li>
<li><code><a title="saev.config.Train.track" href="#saev.config.Train.track">track</a></code></li>
<li><code><a title="saev.config.Train.use_ghost_grads" href="#saev.config.Train.use_ghost_grads">use_ghost_grads</a></code></li>
<li><code><a title="saev.config.Train.wandb_project" href="#saev.config.Train.wandb_project">wandb_project</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.TreeOfLifeDataset" href="#saev.config.TreeOfLifeDataset">TreeOfLifeDataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.TreeOfLifeDataset.label_key" href="#saev.config.TreeOfLifeDataset.label_key">label_key</a></code></li>
<li><code><a title="saev.config.TreeOfLifeDataset.metadata" href="#saev.config.TreeOfLifeDataset.metadata">metadata</a></code></li>
<li><code><a title="saev.config.TreeOfLifeDataset.n_imgs" href="#saev.config.TreeOfLifeDataset.n_imgs">n_imgs</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Webapp" href="#saev.config.Webapp">Webapp</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.Webapp.ckpt" href="#saev.config.Webapp.ckpt">ckpt</a></code></li>
<li><code><a title="saev.config.Webapp.data" href="#saev.config.Webapp.data">data</a></code></li>
<li><code><a title="saev.config.Webapp.device" href="#saev.config.Webapp.device">device</a></code></li>
<li><code><a title="saev.config.Webapp.dump_to" href="#saev.config.Webapp.dump_to">dump_to</a></code></li>
<li><code><a title="saev.config.Webapp.epsilon" href="#saev.config.Webapp.epsilon">epsilon</a></code></li>
<li><code><a title="saev.config.Webapp.images" href="#saev.config.Webapp.images">images</a></code></li>
<li><code><a title="saev.config.Webapp.mean_values_fpath" href="#saev.config.Webapp.mean_values_fpath">mean_values_fpath</a></code></li>
<li><code><a title="saev.config.Webapp.n_workers" href="#saev.config.Webapp.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.Webapp.root" href="#saev.config.Webapp.root">root</a></code></li>
<li><code><a title="saev.config.Webapp.sae_batch_size" href="#saev.config.Webapp.sae_batch_size">sae_batch_size</a></code></li>
<li><code><a title="saev.config.Webapp.sort_by" href="#saev.config.Webapp.sort_by">sort_by</a></code></li>
<li><code><a title="saev.config.Webapp.sparsity_fpath" href="#saev.config.Webapp.sparsity_fpath">sparsity_fpath</a></code></li>
<li><code><a title="saev.config.Webapp.top_img_i_fpath" href="#saev.config.Webapp.top_img_i_fpath">top_img_i_fpath</a></code></li>
<li><code><a title="saev.config.Webapp.top_k" href="#saev.config.Webapp.top_k">top_k</a></code></li>
<li><code><a title="saev.config.Webapp.top_patch_i_fpath" href="#saev.config.Webapp.top_patch_i_fpath">top_patch_i_fpath</a></code></li>
<li><code><a title="saev.config.Webapp.top_values_fpath" href="#saev.config.Webapp.top_values_fpath">top_values_fpath</a></code></li>
<li><code><a title="saev.config.Webapp.topk_batch_size" href="#saev.config.Webapp.topk_batch_size">topk_batch_size</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
